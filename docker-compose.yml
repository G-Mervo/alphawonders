services:
  app:
    image: ghcr.io/g-mervo/alphawonders:latest
    container_name: alphawonders-app
    restart: unless-stopped
    expose:
      - "8080"                          # internal only â€” nginx-proxy routes traffic here
    environment:
      - CI_ENVIRONMENT=production
      # App
      - app.baseURL=${APP_BASE_URL}
      - app.forceGlobalSecureRequests=false
      - app.defaultLocale=en
      - app.negotiateLocale=false
      - app.supportedLocales=[en]
      - app.appTimezone=Africa/Nairobi
      - app.charset=UTF-8
      # Database
      - database.default.hostname=postgres
      - database.default.database=${DB_DATABASE}
      - database.default.username=${DB_USERNAME}
      - database.default.password=${DB_PASSWORD}
      - database.default.DBDriver=Postgre
      - database.default.port=5432
      - database.default.DBPrefix=
      - database.default.charset=utf8
      # Email (SMTP)
      - email.fromEmail=${SMTP_FROM_EMAIL}
      - email.fromName=${SMTP_FROM_NAME}
      - email.protocol=smtp
      - email.SMTPHost=${SMTP_HOST}
      - email.SMTPUser=${SMTP_USER}
      - email.SMTPPass=${SMTP_PASS}
      - email.SMTPPort=${SMTP_PORT}
      - email.SMTPCrypto=${SMTP_CRYPTO}
    volumes:
      - app-writable:/var/www/html/writable
      - app-attachments:/var/www/html/attachments
    networks:
      - shared-services
    healthcheck:
      test: ["CMD-SHELL", "curl -so /dev/null http://localhost:8080/ || exit 1"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

volumes:
  app-writable:
  app-attachments:

networks:
  shared-services:
    external: true
